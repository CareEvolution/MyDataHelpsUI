import { describe, it } from '@jest/globals';
import queryOuraDailyActivity from '../../../src/helpers/daily-data-providers/query-oura-daily-activity';

const data = [{"id":"123","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc1","value":"74","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-11T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-11T11:37:08.596082Z","modifiedDate":"2025-03-11T11:37:08.596082Z","properties":{"score":74,"steps":813,"timestamp":"2025-03-11T04:00:00-04:00","class_5_min":"111111111111111111111111111112333522223323","contributors":{"stay_active":76,"recovery_time":100,"move_every_hour":100,"training_volume":96,"meet_daily_targets":25,"training_frequency":71},"resting_time":9060,"non_wear_time":0,"target_meters":11000,"sedentary_time":2040,"total_calories":1657,"active_calories":40,"target_calories":500,"meters_to_target":9900,"inactivity_alerts":0,"low_activity_time":1380,"high_activity_time":120,"average_met_minutes":1.21875,"medium_activity_time":240,"sedentary_met_minutes":1,"low_activity_met_minutes":17,"high_activity_met_minutes":16,"equivalent_walking_distance":747,"medium_activity_met_minutes":3},"dataSource":{}},
{"id":"124","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc2","value":"72","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-10T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T19:27:34.682291Z","modifiedDate":"2025-03-11T11:36:47.881278Z","properties":{"score":72,"steps":4804,"timestamp":"2025-03-10T05:00:00-04:00","class_5_min":"11111111111111111333422223333333333322222222232222322222222223222322222222222232224444433222322222222222322222222222223222222222222222","contributors":{"stay_active":67,"recovery_time":100,"move_every_hour":95,"training_volume":96,"meet_daily_targets":25,"training_frequency":71},"resting_time":5580,"non_wear_time":0,"target_meters":11000,"sedentary_time":26100,"total_calories":1955,"active_calories":191,"target_calories":500,"meters_to_target":6700,"inactivity_alerts":1,"low_activity_time":6780,"high_activity_time":120,"average_met_minutes":1.53125,"medium_activity_time":1740,"sedentary_met_minutes":2,"low_activity_met_minutes":71,"high_activity_met_minutes":16,"equivalent_walking_distance":4049,"medium_activity_met_minutes":84},"dataSource":{}},
{"id":"125","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc3","value":"76","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-09T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:48:02.223696Z","modifiedDate":"2025-03-10T18:48:02.223696Z","properties":{"score":76,"steps":6599,"timestamp":"2025-03-09T05:00:00-04:00","class_5_min":"11111111111111111111111111111111123353222322323223333333222333333322333222332233233232223320422333322222333233222233232233332233333333432333320000032222222222332332222222221322333333211111111","contributors":{"stay_active":89,"recovery_time":100,"move_every_hour":100,"training_volume":96,"meet_daily_targets":25,"training_frequency":71},"resting_time":37440,"non_wear_time":2820,"target_meters":11000,"sedentary_time":26040,"total_calories":2143,"active_calories":279,"target_calories":500,"meters_to_target":4800,"inactivity_alerts":0,"low_activity_time":19080,"high_activity_time":120,"average_met_minutes":1.34375,"medium_activity_time":900,"sedentary_met_minutes":8,"low_activity_met_minutes":190,"high_activity_met_minutes":17,"equivalent_walking_distance":5530,"medium_activity_met_minutes":37},"dataSource":{}},
{"id":"126","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc4","value":"82","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-08T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:48:02.223696Z","modifiedDate":"2025-03-10T18:48:02.223696Z","properties":{"score":82,"steps":14171,"timestamp":"2025-03-08T04:00:00-05:00","class_5_min":"11111111111111111111111111111111111121233333335555555532233222223200333333333333333323323233332323332233333333333333333332233322333332323222323332333322332332233211111111111111111111111","contributors":{"stay_active":97,"recovery_time":100,"move_every_hour":100,"training_volume":97,"meet_daily_targets":43,"training_frequency":71},"resting_time":35820,"non_wear_time":660,"target_meters":13000,"sedentary_time":21120,"total_calories":2745,"active_calories":843,"target_calories":600,"meters_to_target":-5100,"inactivity_alerts":0,"low_activity_time":25440,"high_activity_time":2520,"average_met_minutes":1.71875,"medium_activity_time":840,"sedentary_met_minutes":5,"low_activity_met_minutes":290,"high_activity_met_minutes":426,"equivalent_walking_distance":16162,"medium_activity_met_minutes":40},"dataSource":{}},
{"id":"127","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc5","value":"71","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-07T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:48:02.223696Z","modifiedDate":"2025-03-10T18:48:02.223696Z","properties":{"score":71,"steps":9999,"timestamp":"2025-03-07T04:00:00-05:00","class_5_min":"11111111112111111211111111111111233333332232323332233223333332222220000322233334443333444442232332222323333232233233233333334222223333222333200000000000000000000000000000000003322223322222232000011111111","contributors":{"stay_active":99,"recovery_time":100,"move_every_hour":100,"training_volume":72,"meet_daily_targets":25,"training_frequency":40},"resting_time":34380,"non_wear_time":12780,"target_meters":11000,"sedentary_time":19200,"total_calories":2271,"active_calories":403,"target_calories":500,"meters_to_target":2100,"inactivity_alerts":0,"low_activity_time":16860,"high_activity_time":60,"average_met_minutes":1.4375,"medium_activity_time":3120,"sedentary_met_minutes":5,"low_activity_met_minutes":193,"high_activity_met_minutes":10,"equivalent_walking_distance":8531,"medium_activity_met_minutes":156},"dataSource":{}},
{"id":"128","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc6","value":"60","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-06T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:48:02.223696Z","modifiedDate":"2025-03-10T18:48:02.223696Z","properties":{"score":60,"steps":6556,"timestamp":"2025-03-06T04:00:00-05:00","class_5_min":"111111111111111111111111111112335222323323233322332234333223322222222233222222233322222332222333222322233322323333332322232223332233222223221212222222222222333332332232233223333222222223323432222222211122212221111212343211112","contributors":{"stay_active":68,"recovery_time":100,"move_every_hour":100,"training_volume":55,"meet_daily_targets":25,"training_frequency":1},"resting_time":32040,"non_wear_time":0,"target_meters":11000,"sedentary_time":36360,"total_calories":2141,"active_calories":264,"target_calories":500,"meters_to_target":5100,"inactivity_alerts":0,"low_activity_time":17100,"high_activity_time":180,"average_met_minutes":1.34375,"medium_activity_time":720,"sedentary_met_minutes":6,"low_activity_met_minutes":185,"high_activity_met_minutes":21,"equivalent_walking_distance":5403,"medium_activity_met_minutes":26},"dataSource":{}},
{"id":"129","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc7","value":"66","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-05T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:48:02.223696Z","modifiedDate":"2025-03-10T18:48:02.223696Z","properties":{"score":66,"steps":6640,"timestamp":"2025-03-05T04:00:00-05:00","class_5_min":"111111111111111111111111111111333522322333323333333332333222233333222222332222322332222222222332222223323222232222222222233234422222222223333322221222222222332212223232233322211223222222330003321332232112321111111","contributors":{"stay_active":76,"recovery_time":100,"move_every_hour":100,"training_volume":58,"meet_daily_targets":43,"training_frequency":1},"resting_time":36840,"non_wear_time":1020,"target_meters":11000,"sedentary_time":31860,"total_calories":2113,"active_calories":267,"target_calories":500,"meters_to_target":5100,"inactivity_alerts":0,"low_activity_time":15600,"high_activity_time":120,"average_met_minutes":1.3125,"medium_activity_time":960,"sedentary_met_minutes":4,"low_activity_met_minutes":180,"high_activity_met_minutes":16,"equivalent_walking_distance":5702,"medium_activity_met_minutes":41},"dataSource":{}},
{"id":"130","participantID":"abcd123","participantIdentifier":"123","namespace":"Oura","type":"daily-activity","identifier":"abc8","value":"64","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-04T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:48:02.223696Z","modifiedDate":"2025-03-10T18:48:02.223696Z","properties":{"score":64,"steps":7596,"timestamp":"2025-03-04T04:00:00-05:00","class_5_min":"11111111111111111111111111111123423322323332222222322222222223222223222222222222333443444422222233323322222222222222222432212222222222222232222222233333223332222230000000022222333333222222322322220011111111","contributors":{"stay_active":70,"recovery_time":100,"move_every_hour":95,"training_volume":58,"meet_daily_targets":43,"training_frequency":1},"resting_time":33900,"non_wear_time":3120,"target_meters":11000,"sedentary_time":35040,"total_calories":2129,"active_calories":278,"target_calories":500,"meters_to_target":4800,"inactivity_alerts":1,"low_activity_time":12240,"high_activity_time":60,"average_met_minutes":1.34375,"medium_activity_time":2040,"sedentary_met_minutes":6,"low_activity_met_minutes":137,"high_activity_met_minutes":8,"equivalent_walking_distance":5881,"medium_activity_met_minutes":99},"dataSource":{}}];

jest.mock('@careevolution/mydatahelps-js', () => {
    return {
        __esModule: true,
        default: {
            queryDeviceDataV2: jest.fn(() => Promise.resolve({ deviceDataPoints: data })),
        }
    }
});

describe('Query Oura Daily Activity', () => {

    it('should return step data', async () => {
        const startDate = new Date('2025-03-04T00:00:00'); // these dates are ignored since this is a mock
        const endDate = new Date('2025-03-11T00:00:00');
        const type = 'steps';
        const result = await queryOuraDailyActivity(startDate, endDate, type);
        expect(result).toEqual({
            '2025-03-04': 7596,
            '2025-03-05': 6640,
            '2025-03-06': 6556,
            '2025-03-07': 9999,
            '2025-03-08': 14171,
            '2025-03-09': 6599,
            '2025-03-10': 4804,
            '2025-03-11': 813
        });
    });

});