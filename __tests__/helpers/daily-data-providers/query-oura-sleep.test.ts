import queryOuraSleep from "../../../src/helpers/daily-data-providers/query-oura-sleep";

const data = [{"id":"123a","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"1","value":"540","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-10T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-10","type":"sleep","period":0,"latency":480,"readiness":{"score":62,"contributors":{"hrv_balance":75,"sleep_balance":46,"previous_night":1,"recovery_index":null,"activity_balance":98,"body_temperature":null,"resting_heart_rate":null,"previous_day_activity":97},"temperature_deviation":null,"temperature_trend_deviation":0.04},"awake_time":991,"efficiency":35,"average_hrv":null,"bedtime_end":"2025-03-09T18:08:27-04:00","time_in_bed":1531,"bedtime_start":"2025-03-09T17:42:56-04:00","average_breath":16.625,"movement_30_sec":"1221111111332222122222211121221232212222222233221122","restless_periods":18,"low_battery_alert":false,"lowest_heart_rate":255,"sleep_phase_5_min":"442444","sleep_score_delta":null,"average_heart_rate":0.0,"rem_sleep_duration":0,"deep_sleep_duration":0,"light_sleep_duration":540,"total_sleep_duration":540,"readiness_score_delta":null,"sleep_algorithm_version":"v2"},"dataSource":{}},
	{"id":"123b","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"2","value":"24240","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-09T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-09","type":"long_sleep","period":1,"latency":2130,"readiness":{"score":75,"contributors":{"hrv_balance":58,"sleep_balance":78,"previous_night":87,"recovery_index":91,"activity_balance":89,"body_temperature":100,"resting_heart_rate":60,"previous_day_activity":69},"temperature_deviation":0.07,"temperature_trend_deviation":0.02},"awake_time":4620,"efficiency":84,"average_hrv":22,"bedtime_end":"2025-03-09T07:52:28-04:00","time_in_bed":28860,"bedtime_start":"2025-03-08T22:51:28-05:00","average_breath":16.625,"movement_30_sec":"4212222212222222222223344431111211111111111111111111111111111111131111133111111122111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111211211111122111111111111111111111111111111111111111111111111111111111122111111111111132111111111111121112211111111111112121211111111111221111111111111111111111111111111111111211113111112111111111222111112211112111111211111111211111222111111221111111123","restless_periods":127,"low_battery_alert":false,"lowest_heart_rate":52,"sleep_phase_5_min":"4444444422111111112442221111111222222123443332222211111232422322222223333332223333232222222343444","sleep_score_delta":0,"average_heart_rate":54.25,"rem_sleep_duration":6270,"deep_sleep_duration":5910,"light_sleep_duration":12060,"total_sleep_duration":24240,"readiness_score_delta":0,"sleep_algorithm_version":"v2"},"dataSource":{}},
	{"id":"123c","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"3","value":"26760","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-08T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-08","type":"long_sleep","period":0,"latency":1980,"readiness":{"score":87,"contributors":{"hrv_balance":76,"sleep_balance":87,"previous_night":95,"recovery_index":100,"activity_balance":94,"body_temperature":86,"resting_heart_rate":80,"previous_day_activity":90},"temperature_deviation":0.24,"temperature_trend_deviation":0.18},"awake_time":5762,"efficiency":82,"average_hrv":33,"bedtime_end":"2025-03-08T07:18:55-05:00","time_in_bed":32522,"bedtime_start":"2025-03-07T22:16:53-05:00","average_breath":16.75,"movement_30_sec":"1111111111211111111122222111222232221111111244324443111111111111111111111111111112111111111111111212111111221111221111111111111111111111111111111111111321111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111122111111111111111111111111111111111111111111111111111111111111111111112211211111111113222213211211112131111111341","restless_periods":193,"low_battery_alert":false,"lowest_heart_rate":50,"sleep_phase_5_min":"2224444333442211212111112124212221111122211122422222222222221442233432322222222223222222222222223333334444444","sleep_score_delta":0,"average_heart_rate":54.375,"rem_sleep_duration":4260,"deep_sleep_duration":4860,"light_sleep_duration":17640,"total_sleep_duration":26760,"readiness_score_delta":0,"sleep_algorithm_version":"v2"},"dataSource":{}},
	{"id":"123d","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"4","value":"20760","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-07T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-07","type":"long_sleep","period":1,"latency":60,"readiness":{"score":76,"contributors":{"hrv_balance":63,"sleep_balance":74,"previous_night":72,"recovery_index":82,"activity_balance":99,"body_temperature":100,"resting_heart_rate":70,"previous_day_activity":89},"temperature_deviation":-0.06,"temperature_trend_deviation":0.0},"awake_time":5262,"efficiency":80,"average_hrv":22,"bedtime_end":"2025-03-07T06:49:13-05:00","time_in_bed":26022,"bedtime_start":"2025-03-06T23:35:31-05:00","average_breath":16.25,"movement_30_sec":"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113112111111111111111111111111111112111111111111111111111111111111111111111111111111211111111111111111111111111111111111111111111111111111111111111111111111111121111111111111111111111111111111111111111111111111111111111111112122122113111111111122211122112111111112232111111111111111211121111111111111111111111112211311111111111111133111222111111331","restless_periods":107,"low_battery_alert":false,"lowest_heart_rate":51,"sleep_phase_5_min":"422211111112332211122221112332221112222222222222222222222223333222222334334434444243444","sleep_score_delta":0,"average_heart_rate":55.875,"rem_sleep_duration":3540,"deep_sleep_duration":4740,"light_sleep_duration":12480,"total_sleep_duration":20760,"readiness_score_delta":0,"sleep_algorithm_version":"v2"},"dataSource":{}},
	{"id":"123e","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"5","value":"26640","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-06T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-06","type":"long_sleep","period":1,"latency":2850,"readiness":{"score":75,"contributors":{"hrv_balance":66,"sleep_balance":79,"previous_night":77,"recovery_index":47,"activity_balance":99,"body_temperature":100,"resting_heart_rate":70,"previous_day_activity":93},"temperature_deviation":-0.06,"temperature_trend_deviation":-0.02},"awake_time":8940,"efficiency":75,"average_hrv":22,"bedtime_end":"2025-03-06T06:31:28-05:00","time_in_bed":35580,"bedtime_start":"2025-03-05T20:38:28-05:00","average_breath":16.125,"movement_30_sec":"21211121121221221121321211111222111211111111134343222111112211221112221111211222121212111111111111111111111111111111111111222221112222221111112111221112122133213211111211133442334331111111111111111111111111111111111111111111111111111111311111111111111111111111111111111111111111211111111111111112111111111111111111111111111111111111111111111111221111111211121111111111111111112111123111111111211111111111111311111111111321112223","restless_periods":121,"low_battery_alert":false,"lowest_heart_rate":51,"sleep_phase_5_min":"44444444442424444444222222222212111142212333332222222222111112243222222222222233333243222222222222232223224444422243344","sleep_score_delta":0,"average_heart_rate":56.125,"rem_sleep_duration":4920,"deep_sleep_duration":3330,"light_sleep_duration":18390,"total_sleep_duration":26640,"readiness_score_delta":0,"sleep_algorithm_version":"v2"},"dataSource":{}},
	{"id":"123f","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"6","value":"450","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-06T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-06","type":"sleep","period":2,"latency":0,"readiness":{"score":58,"contributors":{"hrv_balance":69,"sleep_balance":38,"previous_night":1,"recovery_index":null,"activity_balance":99,"body_temperature":null,"resting_heart_rate":null,"previous_day_activity":93},"temperature_deviation":null,"temperature_trend_deviation":null},"awake_time":1230,"efficiency":27,"average_hrv":null,"bedtime_end":"2025-03-06T16:17:00-05:00","time_in_bed":1680,"bedtime_start":"2025-03-06T15:49:00-05:00","average_breath":16.375,"movement_30_sec":"132212221121111111111112222233221122122222222111111122121","restless_periods":12,"low_battery_alert":false,"lowest_heart_rate":255,"sleep_phase_5_min":"444412","sleep_score_delta":null,"average_heart_rate":0.0,"rem_sleep_duration":0,"deep_sleep_duration":180,"light_sleep_duration":270,"total_sleep_duration":450,"readiness_score_delta":null,"sleep_algorithm_version":"v2"},"dataSource":{}},
	{"id":"123g","participantID":"123","participantIdentifier":"abc1","namespace":"Oura","type":"sleep","identifier":"7","value":"26730","units":null,"startDate":null,"startDateOffset":null,"observationDate":"2025-03-05T00:00:00","observationDateOffset":"00:00:00","insertedDate":"2025-03-10T18:49:10.825144Z","modifiedDate":"2025-03-10T18:49:10.825144Z","properties":{"day":"2025-03-05","type":"long_sleep","period":0,"latency":420,"readiness":{"score":75,"contributors":{"hrv_balance":61,"sleep_balance":75,"previous_night":100,"recovery_index":25,"activity_balance":97,"body_temperature":89,"resting_heart_rate":70,"previous_day_activity":87},"temperature_deviation":0.2,"temperature_trend_deviation":0.43},"awake_time":3055,"efficiency":90,"average_hrv":22,"bedtime_end":"2025-03-05T06:34:30-05:00","time_in_bed":29785,"bedtime_start":"2025-03-04T22:18:05-05:00","average_breath":17.0,"movement_30_sec":"1111111112111111111111111113112211111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111122211111111111111111111111111111312211112232322112221111123111111111111311111111111111111111111111111111112111111111111111111111111112211111111111111111111111111111111111111111111111111111111212211212121111221111111111111111111121313121111","restless_periods":178,"low_battery_alert":false,"lowest_heart_rate":51,"sleep_phase_5_min":"4424222111212122244434432322211112222111232333222222111123333333222222222223332233334222222222224334","sleep_score_delta":0,"average_heart_rate":56.25,"rem_sleep_duration":6810,"deep_sleep_duration":5580,"light_sleep_duration":14340,"total_sleep_duration":26730,"readiness_score_delta":0,"sleep_algorithm_version":"v2"},"dataSource":{}}]

	jest.mock('@careevolution/mydatahelps-js', () => {
		return {
			__esModule: true,
			default: {
				queryDeviceDataV2: jest.fn(() => Promise.resolve({ deviceDataPoints: data })),
			}
		}
	});
	
	describe('Query Oura Sleep', () => {
	
		it('should return sleep total duration data', async () => {
			const startDate = new Date('2025-03-04T00:00:00'); // these dates are ignored since this is a mock
			const endDate = new Date('2025-03-11T00:00:00');
			const type = 'total_sleep_duration';
			const result = await queryOuraSleep(startDate, endDate, type, ["long_sleep"]);
			expect(result).toEqual({
				'2025-03-09': 24240,
				'2025-03-08': 26760,
				'2025-03-07': 20760,
				'2025-03-06': 26640,
				'2025-03-05': 26730
			});
			
		});

		it('should return lowest heart rate', async () => {
			const startDate = new Date('2025-03-04T00:00:00'); // these dates are ignored since this is a mock
			const endDate = new Date('2025-03-11T00:00:00');
			const type = 'lowest_heart_rate';
			const result = await queryOuraSleep(startDate, endDate, type, ["long_sleep"]);
			expect(result).toEqual({
				'2025-03-09': 52,
				'2025-03-08': 50,
				'2025-03-07': 51,
				'2025-03-06': 51,
				'2025-03-05': 51
			});
			
		});
	});
